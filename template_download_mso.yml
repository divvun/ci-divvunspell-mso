parameters:
  word_versions: []
  word_url_template: "https://officecdn-microsoft-com.akamaized.net/pr/C1297A47-86C4-4C1F-97FA-950631F94777/MacAutoupdate/Microsoft_Word_{0}_Installer.pkg"

steps:
  - ${{ each ver in parameters.word_versions }}:
      - script: |
          set -e
          wget -O mso.pkg "$MSO_URL"
          sudo installer -verbose -pkg mso.pkg -target /
          rm mso.pkg
          sudo mv "/Applications/Microsoft Word.app" "$MSO_VER"
          echo "##vso[task.setvariable variable=mso]$MSO --mso \"$PWD/$MSO_VER\""
        displayName: "Install MS Office ${{ ver }}"
        env:
          MSO_VER: ${{ ver }}
          MSO_URL: ${{ format(parameters['word_url_template'], ver) }}
  - script: |
      set -eux
      MSO_VER=$(brew cask cat microsoft-word | grep "version '" | awk -F "'" '{print $2}')
      MSO_URL=${MSO_URL/\{0\}/$MSO_VER}
      wget -O mso.pkg "$MSO_URL"
      sudo installer -verbose -pkg mso.pkg -target /
      rm mso.pkg
      sudo mv "/Applications/Microsoft Word.app" "$MSO_VER"
      echo "##vso[task.setvariable variable=mso]$MSO --mso \"$PWD/$MSO_VER\""
    displayName: "Install latest MS Office"
    env:
      MSO_URL: ${{ parameters['word_url_template'] }}
